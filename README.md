# üìù Memo App - Qu·∫£n l√Ω Memo th√¥ng minh v·ªõi Salesforce

·ª®ng d·ª•ng web hi·ªán ƒë·∫°i ƒë·ªÉ qu·∫£n l√Ω memo ƒë∆∞·ª£c x√¢y d·ª±ng v·ªõi React + Vite v√† t√≠ch h·ª£p v·ªõi Salesforce th√¥ng qua OAuth2 v√† REST API.

## ‚ú® T√≠nh nƒÉng ch√≠nh

- üîê **X√°c th·ª±c OAuth2** v·ªõi Salesforce (Implicit Grant)
- üìã **CRUD Operations** cho Memo (Create, Read, Update, Delete)
- üëÅÔ∏è **View Mode**: Xem chi ti·∫øt memo (read-only)
- ‚úèÔ∏è **Edit Mode**: Ch·ªânh s·ª≠a memo v·ªõi form validation
- üîÑ **Real-time Refresh**: N√∫t t·∫£i l·∫°i danh s√°ch memo
- üì± **Responsive Design**: Ho·∫°t ƒë·ªông t·ªët tr√™n m·ªçi thi·∫øt b·ªã
- üé® **Modern UI/UX**: Thi·∫øt k·∫ø ƒë·∫πp v·ªõi Tailwind CSS

## üõ†Ô∏è Tech Stack

- **Frontend**: React 18, Vite, React Router
- **Styling**: Tailwind CSS
- **Authentication**: OAuth2 (Salesforce)
- **API**: Axios, Salesforce REST API
- **Backend**: Salesforce Apex REST Classes

## üìã Y√™u c·∫ßu h·ªá th·ªëng

- Node.js >= 19.0.0
- npm >= 9.0.0
- Salesforce Developer Account
- Salesforce Connected App ƒë∆∞·ª£c c·∫•u h√¨nh

## üöÄ C√†i ƒë·∫∑t v√† ch·∫°y ·ª©ng d·ª•ng

### 1. Clone v√† c√†i ƒë·∫∑t dependencies

```bash
# Clone repository
cd web-app

# C√†i ƒë·∫∑t dependencies
npm install
```

### 2. C·∫•u h√¨nh bi·∫øn m√¥i tr∆∞·ªùng

T·∫°o file `.env.local` trong th∆∞ m·ª•c `web-app/` v·ªõi n·ªôi dung:

```bash
# Salesforce OAuth2 Configuration
VITE_SF_CLIENT_ID=your_connected_app_client_id
VITE_SF_CLIENT_SECRET=your_connected_app_client_secret
VITE_SALESFORCE_LOGIN_URL=https://your-domain.my.salesforce.com
VITE_SALESFORCE_API_BASE_URL=https://your-domain.my.salesforce.com/services/apexrest
VITE_REDIRECT_URI=http://localhost:3000/auth/callback

# Development
VITE_NODE_ENV=development
```

### 3. C·∫•u h√¨nh Salesforce

#### a) T·∫°o Connected App trong Salesforce:

1. **Setup** ‚Üí **App Manager** ‚Üí **New Connected App**
2. **Connected App Name**: `Memo App`
3. **API Name**: `Memo_App`
4. **Contact Email**: your-email@domain.com
5. **Enable OAuth Settings**: ‚úÖ
6. **Callback URL**: `http://localhost:3000/auth/callback`
7. **Selected OAuth Scopes**:
   - Access your basic information (id, profile, email, address, phone)
   - Access and manage your data (api)
   - Perform requests on your behalf at any time (refresh_token, offline_access)
   - Provide access to your data via the Web (web)
   - Full access (full)

#### b) T·∫°o Custom Object Memo__c:

1. **Setup** ‚Üí **Object Manager** ‚Üí **Create** ‚Üí **Custom Object**
2. **Object Label**: `Memo`
3. **Object Name**: `Memo`
4. **API Name**: `Memo__c`
5. **Fields**:
   - `Name__c` (Text, 255) - Ti√™u ƒë·ªÅ memo
   - `Description__c` (Long Text Area, 32,768) - N·ªôi dung memo

#### c) Deploy Apex REST Classes:

Sao ch√©p v√† deploy c√°c file Apex t·ª´ th∆∞ m·ª•c `salesforce/`:
- `MemoRegistration.cls` - REST API cho CRUD operations
- `MemoUpdate.cls` (n·∫øu c√≥) - Additional REST endpoints

#### d) C·∫•u h√¨nh CORS Settings (B·∫Øt bu·ªôc):

1. **Setup** ‚Üí **Security** ‚Üí **CORS**
2. **New** ‚Üí **Origin URL Pattern**: Th√™m c·∫£ 2 domains:
   - `http://localhost:3000` (cho development)
   - `https://your-vercel-domain.vercel.app` (cho production)
3. **V√≠ d·ª•**: 
   - `http://localhost:3000`
   - `https://memo-web-app-psi.vercel.app`
4. **Save**

‚ö†Ô∏è **L∆∞u √Ω CORS**: 
- **B·∫Øt bu·ªôc** cho c·∫£ development v√† production
- N·∫øu kh√¥ng c√≥ CORS, API calls s·∫Ω b·ªã ch·∫∑n
- Ph·∫£i setup tr∆∞·ªõc khi ch·∫°y app ho·∫∑c deploy

### 4. Ch·∫°y ·ª©ng d·ª•ng

```bash
# Ch·∫°y development server
npm run dev

# ·ª®ng d·ª•ng s·∫Ω ch·∫°y t·∫°i http://localhost:3000
```

## üìñ H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng

### 1. ƒêƒÉng nh·∫≠p
- Truy c·∫≠p `http://localhost:3000`
- Nh·∫•n "ƒêƒÉng nh·∫≠p v·ªõi Salesforce"
- Ho√†n th√†nh OAuth2 flow v·ªõi Salesforce

### 2. Qu·∫£n l√Ω Memo
- **Xem danh s√°ch**: Trang ch·ªß hi·ªÉn th·ªã t·∫•t c·∫£ memo
- **Th√™m m·ªõi**: Nh·∫•n "Th√™m Memo m·ªõi" ‚Üí ƒêi·ªÅn form ‚Üí "T·∫°o memo"
- **Xem chi ti·∫øt**: Click v√†o memo card ‚Üí Xem th√¥ng tin ƒë·∫ßy ƒë·ªß
- **Ch·ªânh s·ª≠a**: T·ª´ trang chi ti·∫øt ‚Üí "Ch·ªânh s·ª≠a" ‚Üí C·∫≠p nh·∫≠t ‚Üí "C·∫≠p nh·∫≠t memo"
- **X√≥a**: T·ª´ trang chi ti·∫øt ho·∫∑c danh s√°ch ‚Üí "X√≥a" ‚Üí X√°c nh·∫≠n
- **T·∫£i l·∫°i**: Nh·∫•n "T·∫£i l·∫°i" ƒë·ªÉ refresh danh s√°ch

### 3. Navigation Flow
```
Home ‚Üí View Details ‚Üí Edit ‚Üí Back to View
Home ‚Üí Direct Edit ‚Üí Back to Home
Home ‚Üí New Memo ‚Üí Back to Home
```

## üîß Configuration Details

### Environment Variables

| Bi·∫øn | M√¥ t·∫£ | V√≠ d·ª• |
|------|-------|-------|
| `VITE_SF_CLIENT_ID` | Consumer Key t·ª´ Connected App | `3MVG9pRzvMkjMb6m...` |
| `VITE_SF_CLIENT_SECRET` | Consumer Secret t·ª´ Connected App | `088B73B70AECA07F...` |
| `VITE_SALESFORCE_LOGIN_URL` | Base URL c·ªßa Salesforce org | `https://domain.my.salesforce.com` |
| `VITE_SALESFORCE_API_BASE_URL` | API endpoint cho Apex REST | `https://domain.my.salesforce.com/services/apexrest` |
| `VITE_REDIRECT_URI` | OAuth callback URL | `http://localhost:3000/auth/callback` |

### CORS Configuration (B·∫Øt bu·ªôc cho m·ªçi environment)

| B∆∞·ªõc | M√¥ t·∫£ | Example |
|------|-------|---------|
| **1. Salesforce CORS Setup** | Setup ‚Üí Security ‚Üí CORS ‚Üí New | Th√™m t·ª´ng domain ri√™ng |
| **2. Development Domain** | `http://localhost:3000` | Exact match, kh√¥ng trailing slash |
| **3. Production Domain** | `https://your-vercel-domain.vercel.app` | Exact match v·ªõi deployed domain |
| **4. Multiple Entries** | T·∫°o ri√™ng entry cho m·ªói domain | Kh√¥ng th·ªÉ d√πng wildcard |

‚ö†Ô∏è **L∆∞u √Ω**: CORS l√† b·∫Øt bu·ªôc cho c·∫£ development v√† production. Kh√¥ng c√≥ CORS = API calls b·ªã block!

### OAuth2 Flow

1. **Authorization Request**: User click ‚Üí Redirect to Salesforce
2. **User Authorization**: User login ‚Üí Grant permissions
3. **Authorization Grant**: Salesforce ‚Üí Redirect with access_token (Implicit Grant)
4. **Access Token**: App extracts token from URL fragment ‚Üí Store in localStorage
5. **API Requests**: Include token in Authorization header

### API Endpoints

| Method | Endpoint | Description |
|--------|----------|-------------|
| `GET` | `/api/memo` | L·∫•y danh s√°ch t·∫•t c·∫£ memo |
| `POST` | `/api/memo` | T·∫°o memo m·ªõi |
| `GET` | `/api/memo/update/{id}` | L·∫•y chi ti·∫øt memo theo ID |
| `PATCH` | `/api/memo/update/{id}` | C·∫≠p nh·∫≠t memo theo ID |
| `DELETE` | `/api/memo/{id}` | X√≥a memo theo ID |

## üé® Design System

### Colors
- **Primary**: Blue gradient (#3B82F6 ‚Üí #1E40AF)
- **Success**: Green (#10B981)
- **Danger**: Red (#EF4444)
- **Neutral**: Gray scale (#F9FAFB ‚Üí #111827)

### Components
- **Buttons**: Consistent padding, rounded corners, hover effects
- **Forms**: Proper validation, loading states, error handling
- **Cards**: Shadow, hover effects, clean layout
- **Navigation**: Breadcrumbs, back buttons, intuitive flow

## ÔøΩ Deployment

### Quick Deploy v·ªõi Vercel (Recommended)

1. **Connect GitHub repo**: 
   - Login v√†o [vercel.com](https://vercel.com)
   - Import project t·ª´ GitHub

2. **Environment Variables** (Settings ‚Üí Environment Variables):
   ```bash
   VITE_SF_CLIENT_ID=your_consumer_key
   VITE_SF_CLIENT_SECRET=your_consumer_secret  
   VITE_SALESFORCE_LOGIN_URL=https://domain.my.salesforce.com
   VITE_SALESFORCE_API_BASE_URL=https://domain.my.salesforce.com/services/apexrest
   VITE_REDIRECT_URI=https://your-app.vercel.app/auth/callback
   ```

3. **Deploy**: Vercel t·ª± ƒë·ªông build v√† deploy khi push code

4. **Update Salesforce CORS**: Th√™m domain production v√†o CORS settings
   - Example: `https://memo-app-xyz.vercel.app`

### Alternative Deployment Options

#### Netlify
T·∫°o file `public/_redirects`:
```
/*    /index.html   200
```

#### GitHub Pages  
Th√™m v√†o `package.json`:
```json
"homepage": "https://yourusername.github.io/repo-name"
```

#### Apache Server
T·∫°o file `public/.htaccess`:
```apache
Options -MultiViews
RewriteEngine On
RewriteCond %{REQUEST_FILENAME} !-f
RewriteRule ^ index.html [QSA,L]
```

## üö® Troubleshooting

### L·ªói 404 khi deploy (SPA Routing)
File `vercel.json` ƒë√£ ƒë∆∞·ª£c c·∫•u h√¨nh ƒë·ªÉ handle client-side routing ‚úÖ

#### Debug steps n·∫øu v·∫´n g·∫∑p l·ªói:
1. **Check build output**:
   ```bash
   npm run build
   ls dist/  # Ph·∫£i c√≥ index.html, assets/, etc.
   ```

2. **Test local build**:
   ```bash
   npm run preview
   # Navigate to different routes ƒë·ªÉ test
   ```

3. **Check deployment logs** tr√™n Vercel dashboard
4. **Verify environment variables** ƒë√£ set ƒë√∫ng tr√™n Vercel

### L·ªói CORS
- **Setup CORS trong Salesforce**: Setup ‚Üí Security ‚Üí CORS ‚Üí Add Origin URL
- **Development**: `http://localhost:3000`
- **Production**: `https://your-app.vercel.app`
- **B·∫Øt bu·ªôc cho c·∫£ 2**: API calls s·∫Ω b·ªã block n·∫øu thi·∫øu b·∫•t k·ª≥ entry n√†o

#### CORS Setup Chi ti·∫øt:
1. **Salesforce Setup** ‚Üí **Security** ‚Üí **CORS**
2. **New CORS Entry** (t·∫°o 2 entries ri√™ng bi·ªát):
   
   **Entry 1 - Development**:
   - **Origin URL Pattern**: `http://localhost:3000`
   
   **Entry 2 - Production**:
   - **Origin URL Pattern**: `https://your-app.vercel.app`

3. **Save** c·∫£ 2 entries
   
   **Entry 2 - Production**:
   - **Origin URL Pattern**: `https://your-vercel-domain.vercel.app`
   
3. **Important Notes**:
   - **Exact match**: Ph·∫£i ch√≠nh x√°c domain v√† port
   - **No wildcards**: Kh√¥ng th·ªÉ d√πng `*` ho·∫∑c patterns
   - **Both required**: C·∫ßn c·∫£ 2 cho dev v√† prod
4. **Multiple environments**: Staging, UAT c≈©ng c·∫ßn entries ri√™ng

### Token h·∫øt h·∫°n
- App t·ª± ƒë·ªông detect token expiry
- User s·∫Ω ƒë∆∞·ª£c redirect v·ªÅ login page

### API Errors
- Check Developer Console trong Salesforce
- Verify Apex class permissions v√† field accessibility

### Environment Issues
- ƒê·∫£m b·∫£o t·∫•t c·∫£ bi·∫øn m√¥i tr∆∞·ªùng ƒë∆∞·ª£c set ƒë√∫ng
- Restart development server sau khi thay ƒë·ªïi .env.local

### Common Deploy Issues

#### Build fails:
```bash
# Clear cache v√† reinstall
rm -rf node_modules package-lock.json
npm install
npm run build
```

#### Blank page after deploy:
- Check browser console for errors
- Verify base URL trong Vite config
- Check if all assets load correctly

#### OAuth redirect fails:
- Update Salesforce Connected App callback URL
- Use HTTPS URL c·ªßa deployed app
- Check CORS settings

## üìù Development Notes

### Project Structure
```
src/
‚îú‚îÄ‚îÄ components/          # Shared components
‚îÇ   ‚îú‚îÄ‚îÄ MemoForm.jsx    # Form cho create/edit memo
‚îÇ   ‚îú‚îÄ‚îÄ MemoList.jsx    # Danh s√°ch memo cards
‚îÇ   ‚îî‚îÄ‚îÄ TestConnection.jsx
‚îú‚îÄ‚îÄ pages/              # Page components
‚îÇ   ‚îú‚îÄ‚îÄ Home.jsx        # Trang ch·ªß/danh s√°ch
‚îÇ   ‚îú‚îÄ‚îÄ Login.jsx       # Trang ƒëƒÉng nh·∫≠p
‚îÇ   ‚îú‚îÄ‚îÄ ViewMemo.jsx    # Xem chi ti·∫øt memo
‚îÇ   ‚îú‚îÄ‚îÄ EditMemo.jsx    # Ch·ªânh s·ª≠a memo
‚îÇ   ‚îú‚îÄ‚îÄ NewMemo.jsx     # T·∫°o memo m·ªõi
‚îÇ   ‚îî‚îÄ‚îÄ AuthCallback.jsx # OAuth callback handler
‚îú‚îÄ‚îÄ auth/hooks/         # Authentication hooks
‚îú‚îÄ‚îÄ utils/              # Utilities (axios config, etc.)
‚îî‚îÄ‚îÄ routes.jsx          # React Router configuration
```

### Key Features Implementation
- **Authentication**: useAuthenticated hook + Layout wrapper
- **Routing**: React Router v·ªõi nested routes
- **State Management**: Local state v·ªõi hooks
- **API Integration**: Axios v·ªõi interceptors
- **Error Handling**: Try-catch v·ªõi user-friendly messages

## üìÑ License

MIT License - Ph√°t tri·ªÉn b·ªüi AI Assistant

---

**Happy Coding! üöÄ**
